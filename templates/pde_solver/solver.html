{% extends 'base.html' %}

{% block title %}Solve PDE - PDE Solver{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <!-- Form Column -->
        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">üî¨ Solve a PDE</h4>
                </div>
                <div class="card-body p-4">
                    <form method="post" class="needs-validation">
                        {% csrf_token %}
                        
                        <!-- Equation Field -->
                        <div class="mb-4">
                            <label for="{{ form.equation.id_for_label }}" class="form-label fw-bold">
                                {{ form.equation.label }}
                            </label>
                            {{ form.equation }}
                            <small class="form-text text-muted d-block mt-2">
                                {{ form.equation.help_text|safe }}
                            </small>
                            {% if form.equation.errors %}
                                <div class="alert alert-danger mt-2">{{ form.equation.errors }}</div>
                            {% endif %}
                        </div>

                        <!-- Boundary Conditions Field -->
                        <div class="mb-4">
                            <label for="{{ form.boundary_conditions.id_for_label }}" class="form-label fw-bold">
                                {{ form.boundary_conditions.label }}
                            </label>
                            {{ form.boundary_conditions }}
                            <small class="form-text text-muted d-block mt-2">
                                {{ form.boundary_conditions.help_text|safe }}
                            </small>
                            {% if form.boundary_conditions.errors %}
                                <div class="alert alert-danger mt-2">{{ form.boundary_conditions.errors }}</div>
                            {% endif %}
                        </div>

                        <!-- Initial Conditions Field -->
                        <div class="mb-4">
                            <label for="{{ form.initial_conditions.id_for_label }}" class="form-label fw-bold">
                                {{ form.initial_conditions.label }}
                            </label>
                            {{ form.initial_conditions }}
                            <small class="form-text text-muted d-block mt-2">
                                {{ form.initial_conditions.help_text|safe }}
                            </small>
                            {% if form.initial_conditions.errors %}
                                <div class="alert alert-danger mt-2">{{ form.initial_conditions.errors }}</div>
                            {% endif %}
                        </div>

                        <!-- Submit Button -->
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <span class="spinner-border spinner-border-sm me-2" id="loadingSpinner" style="display: none;"></span>
                                Solve PDE
                            </button>
                        </div>
                    </form>

                    <!-- Notation Guide -->
                    <div class="alert alert-info mt-4">
                        <h6 class="alert-heading">üìñ Notation Guide</h6>
                        <p class="mb-2"><strong>Partial Derivatives:</strong></p>
                        <ul class="small mb-0">
                            <li>u_t = ‚àÇu/‚àÇt</li>
                            <li>u_x = ‚àÇu/‚àÇx</li>
                            <li>u_xx = ‚àÇ¬≤u/‚àÇx¬≤</li>
                            <li>u_xy = ‚àÇ¬≤u/‚àÇx‚àÇy</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Examples Column -->
        <div class="col-lg-4">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">üìö Examples</h5>
                </div>
                <div class="card-body">
                    {% for pde_type, details in common_solutions.items %}
                    <div class="mb-4 pb-4" style="border-bottom: 1px solid #dee2e6;">
                        <h6 class="text-primary mb-2">{{ pde_type }}</h6>
                        <p class="small mb-1"><strong>Form:</strong></p>
                        <code class="small d-block mb-2">{{ details.form }}</code>
                        <p class="small mb-1"><strong>Boundary:</strong></p>
                        <code class="small">{{ details.example_bc }}</code>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Recent Solutions -->
            {% if recent_solutions %}
            <div class="card shadow-sm">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">‚è±Ô∏è Recent Solutions</h5>
                </div>
                <div class="card-body">
                    {% for solution in recent_solutions %}
                    <div class="mb-3 pb-3" style="border-bottom: 1px solid #dee2e6;">
                        <a href="{% url 'solution_detail' solution.pk %}" class="text-decoration-none text-primary fw-bold small">
                            {{ solution.equation|truncatewords:5 }}...
                        </a>
                        <small class="text-muted d-block">{{ solution.created_at|date:"M d, H:i" }}</small>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    document.querySelector('form').addEventListener('submit', function() {
        document.getElementById('loadingSpinner').style.display = 'inline-block';
    });
</script>
{% endblock %}
